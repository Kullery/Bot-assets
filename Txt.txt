import discord
import random
import json
import os
from discord.ext import commands
from collections import defaultdict

# Configuration des classes de h√©ros
HERO_CLASSES = {
    'Gladiateur': {
        'description': 'Combattant de l\'ar√®ne, ma√Ætre du combat rapproch√©',
        'equipment_slots': ['arme1', 'arme2', 'casque', 'armure', 'babiole1', 'babiole2'],
        'color': 0xFF4444,
        'emoji': '‚öîÔ∏è'
    },
    'G√©n√©ral': {
        'description': 'Strat√®ge militaire, leader sur le champ de bataille',
        'equipment_slots': ['arme', 'banni√®re', 'casque', 'armure', 'babiole1', 'babiole2'],
        'color': 0x8B4513,
        'emoji': 'üõ°Ô∏è'
    },
    'Sage': {
        'description': '√ârudit ancien, gardien de la sagesse',
        'equipment_slots': ['b√¢ton', 'livre', 'casque', 'robe', 'babiole1', 'babiole2'],
        'color': 0x4169E1,
        'emoji': 'üìö'
    },
    'Mage': {
        'description': 'Manipulateur d\'√©nergies magiques',
        'equipment_slots': ['b√¢ton', 'cape', 'casque', 'robe', 'babiole1', 'babiole2'],
        'color': 0x9932CC,
        'emoji': 'üîÆ'
    },
    'N√©cromancien': {
        'description': 'Ma√Ætre des arts interdits et de la mort',
        'equipment_slots': ['b√¢ton', 'cape', 'casque', 'robe', 'livre', 'babiole'],
        'color': 0x2F4F2F,
        'emoji': 'üíÄ'
    },
    'Paladin': {
        'description': 'Champion de la lumi√®re et de la justice',
        'equipment_slots': ['arme', 'bouclier', 'casque', 'armure', 'babiole1', 'babiole2'],
        'color': 0xFFD700,
        'emoji': '‚ú®'
    },
    'Voleur': {
        'description': 'Ma√Ætre de la discr√©tion et de la pr√©cision',
        'equipment_slots': ['arme', 'arc', 'casque', 'armure', 'babiole1', 'babiole2'],
        'color': 0x696969,
        'emoji': 'üó°Ô∏è'
    },
    'Ma√Ætre M√©ca': {
        'description': 'Ing√©nieur de guerre et inventeur de technologies',
        'equipment_slots': ['arme1', 'arme2', 'casque', 'armure', 'babiole1', 'babiole2'],
        'color': 0x708090,
        'emoji': '‚öôÔ∏è'
    }
}

# Base de donn√©es des h√©ros (√† remplir avec tes 46 h√©ros)
HEROES_DATABASE = {
    # H√©ros de d√©part (gratuits apr√®s le premier choix)
    'starter_heroes': {
        'Avril': {
            'name': 'Avril',
            'class': 'Mage',
            'base_power': 120,
            'cost': 0,  # H√©ros de d√©part
            'rarity': 'starter',
            'description': 'Derni√®re survivante des disciples du Temple de glace, Avril se bat pour pr√©server son h√©ritage et fonder un nouveau temple, afin de prot√©ger les terres de Nore.',
            'image': 'Heroes/avril.webp'  # Nom de ton fichier image
        },
        'Avalon': {
            'name': 'Avalon',
            'class': 'G√©n√©ral',
            'base_power': 110,
            'cost': 0,
            'rarity': 'starter',
            'description': "Prince d√©chu des Ailes d'argent, Avalon cherche √† dresser une arm√©e et √† r√©cup√©rer sa terre natale sur le lointain continent de Drake.",
            'image': 'Heroes/Avalon.jpg'
        },
        'Rufio': {
            'name': 'Rufio',
            'class': 'Gladiateur',
            'base_power': 125,
            'cost': 0,
            'rarity': 'starter',
            'description': 'Toute sa vie, Rufio a laiss√© une tra√Æn√©e de champions d√©faits dans son sillage. Il est impressionn√© par les combatants de Nore, et son but est devenu de les d√©fier et de tous les vaincre.',
            'image': 'Heroes/Rufio_portrait.webp'
        }
    },
    
    # H√©ros achetables (exemple de structure)
    'shop_heroes': {
        # H√©ros communs (prix bas)
        'Virion': {
            'name': 'Virion',
            'class': 'Paladin',
            'base_power': 130,
            'cost': 500,
            'rarity': 'common',
            'description': "Virion √©tait le Capitaine de la Garde royale avant la chute d'Aile d'argent. Il a accompagn√© la princesse Elena en Nore, prot√©geant son peuple gr√¢ce √† la juste puissance de la lumi√®re.",
            'image': 'Heroes/Virion_portrait.webp'
        },
        'Vega': {
            'name': 'Vega',
            'class': 'Sage',
            'base_power': 125,
            'cost': 600,
            'rarity': 'common',
            'description': "Enfant des rues arrach√©e √† sa condition par le temple du Soleil, Vega s'est m√©tamorphos√©e en une puissante pr√™tresse.",
            'image': 'Heroes/Vega_portrait.webp'
        },
        'Mako': {
            'name': 'Mako',
            'class': 'Voleur',
            'base_power': 135,
            'cost': 1000,
            'rarity': 'common',
            'description': 'Arm√© de sa fid√®le fronde et de sa bande de turlupins, le jeune Mako r√©gnait sur son village comme un fieff√© roi bandit.',
            'image': 'Heroes/Mako.webp'
        },
        'Gan': {
            'name': 'Gan',
            'class': 'Sage',
            'base_power': 135,
            'cost': 1000,
            'rarity': 'common',
            'description': "Reclu dans les bois depuis des ann√©es, il ma√Ætrise l'art des forces de la for√™t.",
            'image': 'Heroes/Gan_portrait.webp'
        },
        
        'Grimms': {
            'name': 'Grimms',
            'class': 'G√©n√©ral',
            'base_power': 135,
            'cost': 1000,
            'rarity': 'common',
            'description': 'G√©n√©ral nain, Grimms a fait ses preuves maintes fois en d√©fendant les montagnes des morts-vivants mal√©fiques. Il a su √©galement d√©loger les vicieux gobelins qui les parasitent.',
            'image': 'Heroes/Grimms.webp'
        },
        
        'Mako': {
            'name': 'Mako',
            'class': 'Voleur',
            'base_power': 135,
            'cost': 1000,
            'rarity': 'common',
            'description': 'Arm√© de sa fid√®le fronde et de sa bande de turlupins, le jeune Mako r√©gnait sur son village comme un fieff√© roi bandit.',
            'image': 'Heroes/Mako.webp'
        },
        'Cl√©o': {
            'name': 'Cl√©o',
            'class': 'Mage',
            'base_power': 140,
            'cost': 1200,
            'rarity': 'rare',
            'description': "Ultime enfant des mythes de Sphinx, Cl√©o est l'h√©riti√®re d'une connaissance infinie. Elle m√©prise les ignorants, et pourtant, ceux-ci n'apprennent jamais √† √©viter sa col√®re.",
            'image': 'Heroes/Cleo_portrait.webp'
        },
        'Nora': {
            'name': 'Nora',
            'class': 'Ma√Ætre M√©ca',
            'base_power': 125,
            'cost': 1000,
            'rarity': 'common',
            'description': "Il est tr√®s pratique d'avoir un grand-p√®re roi. Il vous laisse manquer les cours pour aller vous amuser sur le champ de bataille et tester vos nouvelles inventions.",
            'image': 'Heroes/Nora_portrait.webp'
        },
        # H√©ros rares (prix moyen)
        'Wraxius': {
            'name': 'Wraxius',
            'class': 'Mage',
            'base_power': 135,
            'cost': 4000,
            'rarity': 'rare',
            'description': "D√©sormais √† l'apog√©e de sa puissance, Wraxius est de retour chez les vivants pour d√©cha√Æner l'√©nergie d√©moniaque de ses lanternes.",
            'image': 'Heroes/Wraxius_portrait.webp'
        },
         'Lunella': {
            'name': 'Lunella',
            'class': 'Paladin',
            'base_power': 140,
            'cost': 4000,
            'rarity': 'rare',
            'description': "Lunella, la fille favorite de la Grande Pr√™tresse a √©t√© choisie parmi ses soeurs les dryades pour servir la d√©esse de la lune par-del√† les c√¥tes embrum√©es de Lunos.",
            'image': 'Heroes/Lunella.webp'
        },
        'Elena': {
            'name': 'Elena',
            'class': 'G√©n√©ral',
            'base_power': 135,
            'cost': 4000,
            'rarity': 'rare',
            'description': "Princesse du royaume d√©chu d'Aile d'argent, Elena mena son peuple vers la s√©curit√©, en Nore, o√π elle lutte pour devenir un chef fort et ind√©pendant en l'absence de son fr√®re, Avalon.",
            'image': 'Heroes/Elena.webp'
        },
        'Bane': {
            'name': 'Bane',
            'class': 'Gladiateur',
            'base_power': 135,
            'cost': 4000,
            'rarity': 'rare',
            'description': "Bane sauva sa tribu barbare de la destruction avec l'aide d'Avril, bravant les flots d√©cha√Æn√©s pour assurer le salut de son peuple en Nore.",
            'image': 'Heroes/Bane_portrait.webp'
        },
        
        'Gladys': {
            'name': 'Gladys',
            'class': 'Sage',
            'base_power': 135,
            'cost': 4000,
            'rarity': 'rare',
            'description': "Gladys a d√©couvert le verre du vide par hasard. Pour aider sa soeur Melias √† exaucer son r√™ve, elle a tout fait pour le contr√¥ler. Malgr√© des difficult√©s, elle y est pervenue et s'est lanc√©e dans une grande aventure: explorer l'√Æle c√©leste.",
            'image': 'heroes/Gladys.png'
        },
        'Ophidia': {
            'name': 'Ophidia',
            'class': 'N√©cromancien',
            'base_power': 135,
            'cost': 4000,
            'rarity': 'rare',
            'description': 'Celui qui croise sa beaut√© asphyxiante p√©rira apr√®s une terrible agonie.',
            'image': 'Heroes/Ophidia.webp'
        },
        'Melias': {
            'name': 'Melias',
            'class': 'Ma√Ætre M√©ca',
            'base_power': 125,
            'cost': 4000,
            'rarity': 'rare',
            'description': "Melias Bright r√™vait de voler dans le ciel depuis sa plus tendre enfance et elle a construit un planeur alors qu'elle n'avait que neuf ans. Aujourd'hui experte dans les jetpacks, elle r√™ve d'emmener tout le monde dans le ciel.",
            'image': 'Heroes/Melias.png'
        },
        'Fenris': {
            'name': 'Fenris',
            'class': 'Voleur',
            'base_power': 140,
            'cost': 4000,
            'rarity': 'rare',
            'description': "Paria warg du nord glacial, Fenris m√®ne ses fr√®res loups dans sa qu√™te de vengeance et lutte pour leur survie.",
            'image': 'Heroes/Fenris.webp'
        },
        
        # H√©ros √©piques (prix haut)
        'Tiadrin': {
            'name': 'Tiadrin',
            'class': 'Paladin',
            'base_power': 1,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Tiadrin est autant critiqu√©e qu'encens√©e pour son √©radication inconditionnelle z√©l√©e de toute forme de t√©n√®bres. dans son esprit, malgr√© tout, la lumi√®re ne peut pas faillir.",
            'image': 'Heroes/Tiadrin_portrait.webp'
        },
        'Pallas': {
            'name': 'Pallas',
            'class': 'Voleur',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Autrefois, pallas a perdu un bras au combat. Apr√®s avoir obsorb√© l'√©nergie d'un m√©t√©ore gravitationnel extraterrestre, il s'est chang√© en seigneur noir et parcourt d√©sormais sans rel√¢che les territoires frontaliers.",
            'image': 'Heroes/Pallas.png'
        },
        'Tisiphone': {
            'name': 'Tisiphone',
            'class': 'N√©cromancien',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "La l√©gendaire reine dragon Tisiphone avait √©t√© il y a bien longtemps le lien entre les dragons et les humains, mais elle avait ensuite plong√© dans un profond sommeil. Quand les humains ont attaqu√© la tani√®re d'un dragon, la col√®re de celui-ci a √©t√© si vive qu'il a r√©veill√© Tisiphone. Bless√©e et folle de rage, elle a jur√© de se venger des cupides humains.",
            'image': 'Heroes/Tisiphone.png'
        },
        'Eyreon': {
            'name': 'Eyreon',
            'class': 'Mage',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Eyreon descend d'une pure lign√©e elfique. Il s'est fait conna√Ætre comme gu√©risseur sp√©cialis√© dans les maladies du sang. Quand la corruption gagna la for√™t, il ne pu r√©sister √† la tentation et transforma ses confr√®res en cobayes.",
            'image': 'Heroes/Eyreon.png'
        },
        'Kaleido': {
            'name': 'Kaleido',
            'class': 'G√©n√©ral',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Errant entre le royaume des vivants et le pays des morts, ce n√©cromancien manipule les √¢mes √† sa guise.",
            'image': 'Heroes/Kaleido.png'
        },
        'Solaris': {
            'name': 'Solaris',
            'class': 'Gladiateur',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Solaris a vu sa famille se faire emporter par un d√©mon quand il √©tait petit. Pour se venger, il a d√ª en devenir un. Apr√®s avoir taill√© son ennemi en pi√®ces membre par membre, il a fait de sa colonne vert√©brale une arme et de son cr√¢ne un masque. Depuis lors, il passe son temps √† chasser des d√©mons.",
            'image': 'Heroes/Solaris.png'
        },
        'Salomon': {
            'name': 'Salomon',
            'class': 'Gladiateur',
            'base_power': 180,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Une tribu l√©gendaire dont les anc√™tres √©taient la prog√©niture ill√©gitime de la divinit√©. Salomon s'est hiss√© √† la t√™te de ce peuple ancien, et la plupart de ses actions sont aujourd'hui dirig√©es contre les √©trangers qui convoitent les pouvoirs inhabituels de la tribu.",
            'image': 'Heroes/salomon.png'
        },
        'Saizo': {
            'name': 'Saizo',
            'class': 'Voleur',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Saizo, le plus dou√© des disciples, s'est vu confier de grandes responsabilit√©s par les anciens. C'est √† lui de former les Nekoma et leurs alli√©s naturels, les Rakan, aux art complexes du subterfuge et de la furtivit√©.",
            'image': 'Heroes/Saizo.webp'
        },
        'Florani': {
            'name': 'Florani',
            'class': 'Sage',
            'base_power': 140,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Depuis le plus jeune √¢ge, Florani se sent √† l'aise parmi les oiseaux. Elle comprend le pouvoir de la protection et du bannissement. C'est √† la fois la gardienne de la vie et l'augure du chaos.",
            'image': 'Heroes/Florani.png'
        },
        'Myra': {
            'name': 'Myra',
            'class': 'Ma√Ætre M√©ca',
            'base_power': 125,
            'cost': 8000,
            'rarity': 'epic',
            'description': "Elle a r√©ussi √† int√©grer le conseil de Nore gr√¢ce √† sa victoire √©crasante lors du championnat de Nore, alors arm√©e de sa toute derni√®re cr√©ation m√©canique.",
            'image': 'Heroes/Myra.jpeg'
        },
        # H√©ros l√©gendaires (prix max)
        'Lee': {
            'name': 'Lee',
            'class': 'Gladiateur',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "Lee est un boxeur qui est parti de chez lui pour s'entra√Æner. Gr√¢ce √† la b√©n√©diction de ses anc√™tres, il s'est chang√© en panda dont les coups sont mus par la foudre et le tonnerre du dragon divin.",
            'image': 'Heroes/Lee.png'
        },
        'Drac': {
            'name': 'Drac',
            'class': 'Voleur',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "En raison du culte qu'elle voue aux dragons, la ville natale de Drac a √©t√© isol√©e et l'hostilit√© a fini par se transformer en attaques. Cependant, le destin a conduit Drac √† secourir un dragon et √† b√©n√©ficier des conseils de Tisiphone. Avec le dragon, Drac s'est lanc√© dans une exp√©dition de vengeance.",
            'image': 'Heroes/Drach.png'
        },
        
        'Baelrog': {
            'name': 'Baelrog',
            'class': 'Gladiateur',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "Les grands jotuns, inconnus du reste du monde, r√®gnent sur les pics glac√©s de Nore tels des demi-dieux. cependant, le grand chasseur Baelrog ne recule devant rien. Il a une nouvelle proie en vue.",
            'image': 'Heroes/Baelrog.webp'
        },
        'Marlena': {
            'name': 'Marlena',
            'class': 'Paladin',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "La pr√™tresse marlena, la soeur qui a surmont√© les difficult√©s et s'est entra√Æn√©e f√©rocement pour aider les bless√©s sur le champ de bataille.",
            'image': 'Heroes/Marlena.png'
        },
        'Cyrus': {
            'name': 'Cyrus',
            'class': 'G√©n√©ral',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "Un roi du d√©sert, invaincu en terme de strat√©gie et de combat, d√©fenseur du domaine contre les menaces et l'√©rosion.",
            'image': 'Heroes/Cyrus.png'
        },
        'Vallari': {
            'name': 'Vallari',
            'class': 'Mage',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "N√©e avec la capacit√© de contr√¥ler le feu, Vallari fut rejet√©e par ses parents et vendue √† un magicien noir. Ayant √©chapp√© √† son ravisseur, elle se bat d√©sormais pour d√©fendre les faibles.",
            'image': 'Heroes/Drach.png'
        },
        'Yip': {
            'name': 'Yip',
            'class': 'Sage',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "Le ma√Ætre de la lame Raken originel, ma√Ætre Yip est √† la fois un instructeur talentueux et un apprenti astucieux. Apr√®s de nombreux si√®cles √† perfectionner ses techniques √©l√©mentaires, il ne fait d√©sormais plus qu'un avec le vent. Il a m√™me choisi de poser son √©p√©e, pour adopter l'air lui-m√™me comme nouvelle lame.",
            'image': 'Heroes/Yip.webp'
        },
        'Gazul': {
            'name': 'Gazul',
            'class': 'N√©cromancien',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "Certains pr√©tendent que Gazul fut un jour roi, tandis que d'autres avancent qu'il aurait √©t√© un magicien noir. Gazul lui-m√™me ne s'en souvient pas, son √¢me ayant √©t√© consum√©e par le vide.",
            'image': 'Heroes/Gazul.webp'
        },
        'Jacques': {
            'name': 'Jacques',
            'class': 'Ma√Ætre M√©ca',
            'base_power': 180,
            'cost': 16000,
            'rarity': 'legendary',
            'description': "Jacques s'engagea sur un coup de t√™te pour exhiber se combinaison m√©canique. Sa passion pour le bricolage frise l'hyst√©rie, mais c'est pr√©cis√©ment cette ferveur qui alimente la puissance de l'arm√©e naine.",
            'image': 'Jacques_portrait.webp'
        },
        
    }
}

# Raret√©s des h√©ros
HERO_RARITIES = {
    'starter': {'color': 0x808080, 'name': 'D√©butant'},
    'common': {'color': 0xFFFFFF, 'name': 'Commun'},
    'rare': {'color': 0x0080FF, 'name': 'Rare'},
    'epic': {'color': 0x8000FF, 'name': '√âpique'},
    'legendary': {'color': 0xFF8000, 'name': 'L√©gendaire'},
}

# Configuration du bot
intents = discord.Intents.default()
intents.message_content = True
bot = commands.Bot(command_prefix='!', intents=intents, help_command=None)

# Base de donn√©es des joueurs
players_data = {}

def load_player_data():
    """Charge les donn√©es des joueurs"""
    global players_data
    try:
        if os.path.exists('players.json'):
            with open('players.json', 'r', encoding='utf-8') as f:
                players_data = json.load(f)
    except Exception as e:
        print(f"Erreur lors du chargement: {e}")
        players_data = {}

def save_player_data():
    """Sauvegarde les donn√©es des joueurs"""
    try:
        with open('players.json', 'w', encoding='utf-8') as f:
            json.dump(players_data, f, indent=2, ensure_ascii=False)
    except Exception as e:
        print(f"Erreur lors de la sauvegarde: {e}")

def get_player(user_id):
    """R√©cup√®re ou cr√©e un joueur"""
    user_id = str(user_id)
    if user_id not in players_data:
        players_data[user_id] = {
            'coins': 1000,
            'heroes': {},
            'starter_choice_made': False,
            'starter_heroes_unlocked': []
        }
        save_player_data()
    return players_data[user_id]

def create_hero_instance(hero_id, hero_data):
    """Cr√©e une instance d'un h√©ros"""
    class_info = HERO_CLASSES[hero_data['class']]
    
    return {
        'id': hero_id,
        'name': hero_data['name'],
        'class': hero_data['class'],
        'base_power': hero_data['base_power'],
        'rarity': hero_data['rarity'],
        'description': hero_data['description'],
        'image': hero_data['image'],
        'equipment': {slot: None for slot in class_info['equipment_slots']},
        'total_power': hero_data['base_power'],
        'level': 1
    }

def calculate_hero_power(hero):
    """Calcule la puissance totale d'un h√©ros"""
    total_power = hero['base_power']
    for slot, equipment in hero['equipment'].items():
        if equipment:
            total_power += equipment.get('power', 0)
    return total_power

def get_all_heroes():
    """Retourne tous les h√©ros disponibles"""
    all_heroes = {}
    all_heroes.update(HEROES_DATABASE['starter_heroes'])
    all_heroes.update(HEROES_DATABASE['shop_heroes'])
    return all_heroes

@bot.event
async def on_ready():
    print(f'{bot.user} est par√© !')
    load_player_data()

@bot.command(name='start')
async def start_game(ctx):
    """D√©marre le jeu avec le choix du h√©ros de d√©part"""
    player = get_player(ctx.author.id)
    
    if player['starter_choice_made']:
        await ctx.send("Tu as d√©j√† fait ton choix de d√©part ! Utilise `!heroes` pour voir tes h√©ros.")
        return
    
    starter_heroes = HEROES_DATABASE['starter_heroes']
    
    embed = discord.Embed(
        title="üéÆ Bienvenue dans l'Ar√®ne des H√©ros !",
        description="Choisis ton premier h√©ros parmi ces trois champions !\n*Les deux autres te seront offerts apr√®s ton choix.*",
        color=0x00FF00
    )
    
    hero_list = ""
    for i, (hero_id, hero_data) in enumerate(starter_heroes.items(), 1):
        class_info = HERO_CLASSES[hero_data['class']]
        hero_list += f"{i}. {class_info['emoji']} **{hero_data['name']}** ({hero_data['class'].title()})\n"
        hero_list += f"   Puissance: {hero_data['base_power']} - {hero_data['description']}\n\n"
    
    embed.add_field(name="H√©ros de d√©part disponibles", value=hero_list, inline=False)
    embed.set_footer(text="Utilise !choose <num√©ro> pour faire ton choix")
    
    await ctx.send(embed=embed)

@bot.command(name='choose')
async def choose_starter_hero(ctx, choice: int = None):
    """Choisit le h√©ros de d√©part"""
    if choice is None:
        await ctx.send("Tu dois sp√©cifier un num√©ro ! Exemple: `!choose 1`")
        return
    
    player = get_player(ctx.author.id)
    
    if player['starter_choice_made']:
        await ctx.send("Tu as d√©j√† fait ton choix de d√©part !")
        return
    
    starter_heroes = list(HEROES_DATABASE['starter_heroes'].items())
    if choice < 1 or choice > len(starter_heroes):
        await ctx.send(f"Choix invalide ! Choisis entre 1 et {len(starter_heroes)}.")
        return
    
    # Ajouter le h√©ros choisi en premier
    chosen_hero_id, chosen_hero_data = starter_heroes[choice - 1]
    player['heroes'][chosen_hero_id] = create_hero_instance(chosen_hero_id, chosen_hero_data)
    player['starter_heroes_unlocked'].append(chosen_hero_id)
    
    # Ajouter les deux autres h√©ros gratuitement
    for hero_id, hero_data in starter_heroes:
        if hero_id != chosen_hero_id:
            player['heroes'][hero_id] = create_hero_instance(hero_id, hero_data)
            player['starter_heroes_unlocked'].append(hero_id)
    
    player['starter_choice_made'] = True
    save_player_data()
    
    class_info = HERO_CLASSES[chosen_hero_data['class']]
    
    embed = discord.Embed(
        title="üéâ Choix confirm√© !",
        description=f"Tu as choisi **{chosen_hero_data['name']}** comme h√©ros principal !",
        color=class_info['color']
    )
    
    embed.add_field(
        name=f"{class_info['emoji']} {chosen_hero_data['class'].title()}",
        value=f"Puissance: {chosen_hero_data['base_power']}\n{chosen_hero_data['description']}",
        inline=False
    )
    
    embed.add_field(
        name="üéÅ Bonus de d√©part",
        value="Les deux autres h√©ros de d√©part ont √©t√© ajout√©s √† ta collection !",
        inline=False
    )
    
    embed.add_field(
        name="Emplacements d'√©quipement",
        value=f"‚Ä¢ {chr(10).join(class_info['equipment_slots'])}",
        inline=True
    )
    
    embed.set_footer(text="Utilise !heroes pour voir tous tes h√©ros ou !profile pour ton profil")
    
    await ctx.send(embed=embed)

@bot.command(name='heroes', aliases=['h√©ros', 'h'])
async def show_heroes(ctx):
    """Affiche tous les h√©ros du joueur"""
    player = get_player(ctx.author.id)
    
    if not player['heroes']:
        await ctx.send("Tu n'as pas encore de h√©ros ! Utilise `!start` pour commencer.")
        return
    
    embed = discord.Embed(
        title=f"ü¶∏‚Äç‚ôÇÔ∏è H√©ros de {ctx.author.display_name}",
        color=0x0099FF
    )
    
    for hero_id, hero in player['heroes'].items():
        class_info = HERO_CLASSES[hero['class']]
        rarity_info = HERO_RARITIES[hero['rarity']]
                
        hero_info = f"{class_info['emoji']} **{hero['class'].title()}** {status}\n"
        hero_info += f"Puissance: {calculate_hero_power(hero)} | Niveau: {hero['level']}\n"
        hero_info += f"Raret√©: {rarity_info['name']}\n"
        hero_info += f"*{hero['description']}*"
        
        embed.add_field(
            name=hero['name'],
            value=hero_info,
            inline=True
        )
    
    await ctx.send(embed=embed)

@bot.command(name='profile', aliases=['p'])
async def show_profile(ctx):
    """Affiche le profil du joueur"""
    player = get_player(ctx.author.id)
    
    if not player['active_hero']:
        await ctx.send("Tu n'as pas de h√©ros actif ! Utilise `!start` pour commencer.")
        return
    
    hero = player['heroes'][player['active_hero']]
    class_info = HERO_CLASSES[hero['class']]
    
    embed = discord.Embed(
        title=f"üìä Profil de {ctx.author.display_name}",
        color=class_info['color']
    )
    
    embed.add_field(name="Pi√®ces", value=f"{player['coins']} ü™ô", inline=True)
    embed.add_field(name="H√©ros poss√©d√©s", value=f"{len(player['heroes'])}", inline=True)
    embed.add_field(name="‚Äé", value="‚Äé", inline=True)  # Spacer
    
    embed.add_field(
        name=f"{class_info['emoji']} H√©ros actif: {hero['name']}",
        value=f"**{hero['class'].title()}** - Niveau {hero['level']}\nPuissance totale: **{calculate_hero_power(hero)}**",
        inline=False
    )
    
    # √âquipement
    equipment_text = ""
    for slot in class_info['equipment_slots']:
        equipment = hero['equipment'][slot]
        if equipment:
            equipment_text += f"**{slot.title()}**: {equipment['name']} (+{equipment['power']})\n"
        else:
            equipment_text += f"**{slot.title()}**: *Vide*\n"
    
    embed.add_field(name="√âquipement", value=equipment_text, inline=False)
    
    await ctx.send(embed=embed)

@bot.command(name='shutdown')
@commands.is_owner()
async def sdown(ctx):
    """Arr√™te le bot (r√©serv√© au propri√©taire)"""
    try:
        # Sauvegarde finale des donn√©es
        save_player_data()
        
        embed = discord.Embed(
            title="üî¥ Arr√™t du bot",
            description="Sauvegarde en cours et arr√™t du bot...",
            color=0xFF0000
        )
        
        await ctx.send(embed=embed)
        
        print("Bot en cours d'arr√™t...")
        await bot.close()
        
    except Exception as e:
        await ctx.send(f"Erreur lors de l'arr√™t : {e}")
        print(f"Erreur shutdown: {e}")

@bot.command(name='classes')
async def show_classes(ctx):
    """Affiche toutes les classes disponibles"""
    embed = discord.Embed(
        title="‚öîÔ∏è Classes de H√©ros",
        description="Voici toutes les classes disponibles dans le jeu",
        color=0x00FF00
    )
    
    for class_name, class_info in HERO_CLASSES.items():
        equipment_list = "‚Ä¢ " + "\n‚Ä¢ ".join(class_info['equipment_slots'])
        
        embed.add_field(
            name=f"{class_info['emoji']} {class_name.title()}",
            value=f"{class_info['description']}\n\n**√âquipements:**\n{equipment_list}",
            inline=True
        )
    
    await ctx.send(embed=embed)

@bot.command(name='aide', aliases=['help'])
async def show_help(ctx):
    """Affiche l'aide du jeu"""
    embed = discord.Embed(
        title="üéÆ Aide - Syst√®me de H√©ros",
        description="Guide des commandes disponibles",
        color=0x00FF00
    )
    
    commands_text = """
    `!start` - Commencer l'aventure et choisir un h√©ros
    `!choose <num√©ro>` - Choisir ton h√©ros de d√©part
    `!heroes` ou `!h` - Voir tous tes h√©ros
    `!profile` ou `!p` - Afficher ton profil
    `!classes` - Voir toutes les classes
    `!help` - Afficher cette aide
    """
    
    embed.add_field(name="Commandes", value=commands_text, inline=False)
    
    embed.add_field(
        name="Classes disponibles",
        value="Gladiateur, G√©n√©ral, Sage, Mage, N√©cromancien, Paladin, Voleur, Ma√Ætre M√©ca",
        inline=False
    )
    
    await ctx.send(embed=embed)

# Gestion d'erreurs
@bot.event
async def on_command_error(ctx, error):
    if isinstance(error, commands.CommandNotFound):
        await ctx.send("Commande inconnue ! Utilise `!help` pour voir les commandes disponibles.")
    elif isinstance(error, commands.MissingRequiredArgument):
        await ctx.send("Il manque des arguments √† ta commande ! Utilise `!help` pour plus d'infos.")
    else:
        print(f"Erreur: {error}")

TOKEN = 'MTM4Mzg5ODU4OTc2NzQwNTYwMA.G3HsgH.kCrGD7nFupiu14iCU0o15KqgsHNxtp_LiDMHis'
bot.run('MTM4Mzg5ODU4OTc2NzQwNTYwMA.G3HsgH.kCrGD7nFupiu14iCU0o15KqgsHNxtp_LiDMHis')